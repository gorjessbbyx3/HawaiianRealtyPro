{% extends "base.html" %}

{% block title %}Add Property - Hawaii Elite Realty{% endblock %}

{% block content %}
<div class="container mt-5 pt-4">
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <div class="form-container">
                <div class="text-center mb-4">
                    <h2 class="text-primary-blue">
                        <i class="fas fa-plus-circle me-2"></i>Add New Property
                    </h2>
                    <p class="text-muted">List your property on Hawaii Elite Realty</p>
                </div>
                
                <form method="POST" enctype="multipart/form-data" class="needs-validation" novalidate>
                    {{ form.hidden_tag() }}
                    
                    <!-- Basic Information -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-info-circle me-2"></i>Basic Information
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                {{ form.title.label(class="form-label") }}
                                {{ form.title(class="form-control" + (" is-invalid" if form.title.errors else "")) }}
                                {% if form.title.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.title.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="mb-3">
                                {{ form.description.label(class="form-label") }}
                                {{ form.description(class="form-control" + (" is-invalid" if form.description.errors else ""), rows="4") }}
                                {% if form.description.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.description.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    {{ form.price.label(class="form-label") }}
                                    <div class="input-group">
                                        <span class="input-group-text">$</span>
                                        {{ form.price(class="form-control" + (" is-invalid" if form.price.errors else ""), data_currency="true") }}
                                        {% if form.price.errors %}
                                            <div class="invalid-feedback">
                                                {% for error in form.price.errors %}{{ error }}{% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    {{ form.property_type.label(class="form-label") }}
                                    {{ form.property_type(class="form-select" + (" is-invalid" if form.property_type.errors else "")) }}
                                    {% if form.property_type.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.property_type.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                {{ form.status.label(class="form-label") }}
                                {{ form.status(class="form-select" + (" is-invalid" if form.status.errors else "")) }}
                                {% if form.status.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.status.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Property Details -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-home me-2"></i>Property Details
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    {{ form.bedrooms.label(class="form-label") }}
                                    {{ form.bedrooms(class="form-control" + (" is-invalid" if form.bedrooms.errors else "")) }}
                                    {% if form.bedrooms.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.bedrooms.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                
                                <div class="col-md-4 mb-3">
                                    {{ form.bathrooms.label(class="form-label") }}
                                    {{ form.bathrooms(class="form-control" + (" is-invalid" if form.bathrooms.errors else "")) }}
                                    {% if form.bathrooms.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.bathrooms.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                
                                <div class="col-md-4 mb-3">
                                    {{ form.year_built.label(class="form-label") }}
                                    {{ form.year_built(class="form-control" + (" is-invalid" if form.year_built.errors else "")) }}
                                    {% if form.year_built.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.year_built.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    {{ form.square_feet.label(class="form-label") }}
                                    {{ form.square_feet(class="form-control" + (" is-invalid" if form.square_feet.errors else "")) }}
                                    {% if form.square_feet.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.square_feet.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    {{ form.lot_size.label(class="form-label") }}
                                    {{ form.lot_size(class="form-control" + (" is-invalid" if form.lot_size.errors else "")) }}
                                    {% if form.lot_size.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.lot_size.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Location -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-map-marker-alt me-2"></i>Location
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                {{ form.address.label(class="form-label") }}
                                {{ form.address(class="form-control" + (" is-invalid" if form.address.errors else "")) }}
                                {% if form.address.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.address.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="row">
                                <div class="col-md-8 mb-3">
                                    {{ form.city.label(class="form-label") }}
                                    {{ form.city(class="form-control" + (" is-invalid" if form.city.errors else "")) }}
                                    {% if form.city.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.city.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                
                                <div class="col-md-4 mb-3">
                                    {{ form.zip_code.label(class="form-label") }}
                                    {{ form.zip_code(class="form-control" + (" is-invalid" if form.zip_code.errors else "")) }}
                                    {% if form.zip_code.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.zip_code.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Features & Media -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-star me-2"></i>Features & Media
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                {{ form.features.label(class="form-label") }}
                                <small class="text-muted">Enter each feature on a new line</small>
                                {{ form.features(class="form-control" + (" is-invalid" if form.features.errors else ""), rows="4", placeholder="Swimming Pool\nOcean View\nGourmet Kitchen\nWalk-in Closets") }}
                                {% if form.features.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.features.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    {{ form.virtual_tour_url.label(class="form-label") }}
                                    {{ form.virtual_tour_url(class="form-control" + (" is-invalid" if form.virtual_tour_url.errors else ""), placeholder="https://example.com/virtual-tour") }}
                                    {% if form.virtual_tour_url.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.virtual_tour_url.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                
                                <div class="col-md-6 mb-3">
                                    {{ form.video_url.label(class="form-label") }}
                                    {{ form.video_url(class="form-control" + (" is-invalid" if form.video_url.errors else ""), placeholder="https://youtube.com/watch?v=...") }}
                                    {% if form.video_url.errors %}
                                        <div class="invalid-feedback">
                                            {% for error in form.video_url.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Property Images -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-camera me-2"></i>Property Images
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                {{ form.images.label(class="form-label") }}
                                <small class="text-muted d-block">Select multiple images (JPG, PNG, GIF up to 16MB total)</small>
                                {{ form.images(class="form-control" + (" is-invalid" if form.images.errors else ""), multiple=True, accept="image/*") }}
                                {% if form.images.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.images.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div id="images-preview" class="mt-3"></div>
                            
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>
                                <strong>Tip:</strong> Upload high-quality images for better visibility. The first image will be used as the main property photo.
                            </div>
                        </div>
                    </div>
                    
                    <!-- Submit Button -->
                    <div class="text-center">
                        <button type="submit" class="btn btn-primary btn-lg px-5">
                            <i class="fas fa-save me-2"></i>Add Property
                        </button>
                        <a href="{{ url_for('auth.dashboard') }}" class="btn btn-outline-secondary btn-lg px-5 ms-3">
                            <i class="fas fa-times me-2"></i>Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<style>
.card-header {
    background: linear-gradient(135deg, var(--primary-blue), var(--ocean-blue));
    color: white;
}

.input-group-text {
    background: var(--light-gray);
    border-color: #ced4da;
}

#images-preview img {
    border-radius: 8px;
    border: 2px solid #dee2e6;
    transition: all 0.3s ease;
}

#images-preview img:hover {
    border-color: var(--primary-blue);
}
</style>

<script>
// Image preview functionality
document.getElementById('images').addEventListener('change', function() {
    const preview = document.getElementById('images-preview');
    preview.innerHTML = '';
    
    Array.from(this.files).forEach(file => {
        const reader = new FileReader();
        reader.onload = function(e) {
            const img = document.createElement('img');
            img.src = e.target.result;
            img.className = 'img-thumbnail me-2 mb-2';
            img.style.width = '120px';
            img.style.height = '120px';
            img.style.objectFit = 'cover';
            preview.appendChild(img);
        };
        reader.readAsDataURL(file);
    });
});

// Price formatting
document.getElementById('price').addEventListener('input', function() {
    let value = this.value.replace(/,/g, '');
    if (!isNaN(value) && value !== '') {
        this.value = Number(value).toLocaleString();
    }
});

// Auto-generate title based on address and city
document.getElementById('address').addEventListener('blur', function() {
    const titleField = document.getElementById('title');
    const cityField = document.getElementById('city');
    
    if (!titleField.value && this.value && cityField.value) {
        titleField.value = `Beautiful Property in ${cityField.value}`;
    }
});
</script>
{% endblock %}
